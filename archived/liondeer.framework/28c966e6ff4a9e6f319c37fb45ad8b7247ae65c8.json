{
    "manifests": {
        "liondeer/framework": {
            "manifest": {
                "bundles": {
                    "liondeer\\framework\\LiondeerFrameworkBundle": [
                        "all"
                    ]
                },
                "copy-from-recipe": {
                    "config/": "config/",
                    "src/": "src/"
                },
                "container": {
                    "app_env": "%env(APP_ENV)%",
                    "d3_app_name": "%env(D3_APP_NAME)%",
                    "d3_app_secret": "%env(D3_APP_SECRET)%",
                    "app_default_locale": "%env(APP_DEFAULT_LOCALE)%",
                    "d3_database_url": "%env(d3_db_url:D3_APP_NAME)%"
                },
                "env": {
                    "D3_APP_NAME": "provider-appName",
                    "D3_APP_SECRET": "secret",
                    "D3_DEFAULT_LOCALE": "de",
                    "APP_DEFAULT_LOCALE": "de",
                    "DATABASE_URL": "mysql://db:db@db:3306/db?serverVersion=5.7",
                    "CORS_ALLOW_ORIGIN": "$SERVER['HTTP_HOST']",
                    "TRUSTED_PROXIES": "127.0.0.1,REMOTE_ADDR"
                },
                "post-install-output": [
                    "<fg=blue>Read</>Read the documentation at <comment>https://github.com/LionAndDeer/d3FrameworkBundle/blob/main/README.md</>"
                ]
            },
            "files": {
                "config/liondeerFramework.yaml": {
                    "contents": [
                        "services:",
                        "  _defaults:",
                        "    bind:",
                        "      Psr\\Log\\LoggerInterface $logger: '@logger'",
                        "      $d3AppName: '%env(D3_APP_NAME)%'",
                        "",
                        "security:",
                        "  # https://symfony.com/doc/current/security.html#where-do-users-come-from-user-providers",
                        "  providers:",
                        "    users_in_memory: { memory: null }",
                        "    # used to reload user from session & other features (e.g. switch_user)",
                        "    app_user_provider:",
                        "      id: App\\security\\UserProvider",
                        "    interAppUser:",
                        "      entity:",
                        "        class: 'App\\security\\User'",
                        "        property: 'tenantId'",
                        "  firewalls:",
                        "    dev:",
                        "      pattern: ^/%d3_app_name%/(_(profiler|wdt)|css|images|js)/",
                        "      security: false",
                        "    stage:",
                        "      pattern: ^/(_(profiler|wdt)|css|images|js)/",
                        "      security: false",
                        "    lifecycle:",
                        "      pattern: ^/%d3_app_name%/dvelop-cloud-lifecycle-event",
                        "      security: false",
                        "    interAppIdentityProvider:",
                        "      pattern: ^/%d3_app_name%/interappauthenticationcallback",
                        "      security: false",
                        "    userIdentityProvider:",
                        "      pattern: ^/%d3_app_name%/userauthenticationcallback",
                        "      security: false",
                        "    upservice:",
                        "      pattern: ^/%d3_app_name%/upservice",
                        "      security: false",
                        "    index:",
                        "      anonymous: true",
                        "      provider: interAppUser",
                        "      pattern: ^/%d3_app_name%(/|)$",
                        "      guard:",
                        "        authenticators:",
                        "          - Liondeer\\Security\\InterAppD3ecmAuthenticator",
                        "    indexFeature:",
                        "      anonymous: true",
                        "      provider: interAppUser",
                        "      pattern: ^/%d3_app_name%/(configfeatures|features|dmsobjectextensions)$",
                        "      guard:",
                        "        authenticators:",
                        "          - Liondeer\\Security\\InterAppD3ecmAuthenticator",
                        "    D3webhook:",
                        "      anonymous: false",
                        "      pattern: ^/%d3_app_name%/webhook/document/create",
                        "      provider: interAppUser",
                        "      guard:",
                        "        authenticators:",
                        "          - App\\security\\D3WebhookAuthenticator",
                        "        entry_point: Liondeer\\Security\\D3ecmAuthenticator",
                        "    SmartInvoiceWebhook:",
                        "      anonymous: false",
                        "      pattern: ^/%d3_app_name%/webhook/(document/smartinvoice|data)",
                        "      provider: interAppUser",
                        "      guard:",
                        "        authenticators:",
                        "          - App\\security\\SmartInvoiceWebhookAuthenticator",
                        "        entry_point: App\\security\\SmartInvoiceWebhookAuthenticator",
                        "    main:",
                        "      anonymous: false",
                        "      lazy: true",
                        "      provider: users_in_memory",
                        "      guard:",
                        "        authenticators:",
                        "          - Liondeer\\Security\\D3ecmAuthenticator",
                        "      stateless: true",
                        "    translation:",
                        "      pattern: ^/%d3_app_name%/translation.js",
                        "      security: false",
                        ""
                    ],
                    "executable": false
                },
                "src/Controller/TranslationController.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\Controller;",
                        "",
                        "use Psr\\Log\\LoggerInterface;",
                        "use Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;",
                        "use Symfony\\Component\\HttpFoundation\\Request;",
                        "use Symfony\\Component\\HttpFoundation\\Response;",
                        "use Symfony\\Component\\Routing\\Annotation\\Route;",
                        "use Symfony\\Component\\Yaml\\Yaml;",
                        "",
                        "class TranslationController extends AbstractController",
                        "{",
                        "    public function __construct()",
                        "    {",
                        "    }",
                        "",
                        "    #[Route('/translation.js', name: 'translation')]",
                        "    public function index(Request $request): Response",
                        "    {",
                        "        $locale = $request->getLocale();",
                        "        $file = __DIR__ . '/../../translations/messages.' . $locale . '.yml';",
                        "        $parsed = Yaml::parse(file_get_contents($file));",
                        "",
                        "        $translations = $this->renderView(",
                        "            'translation/translation.js.twig',",
                        "            [",
                        "                'json' => addslashes(json_encode($parsed)),",
                        "            ]",
                        "        );",
                        "",
                        "        return new Response($translations, Response::HTTP_OK, ['content-type' => 'text/javascript']);",
                        "    }",
                        "",
                        "}"
                    ],
                    "executable": false
                },
                "src/Controller/UpserviceController.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\Controller;",
                        "",
                        "use Doctrine\\Common\\Collections\\ArrayCollection;",
                        "use Psr\\Log\\LoggerInterface;",
                        "use Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;",
                        "use Symfony\\Component\\HttpFoundation\\Response;",
                        "use Symfony\\Component\\Routing\\Annotation\\Route;",
                        "",
                        "",
                        "class UpserviceController extends AbstractController",
                        "{",
                        "    public function __construct(",
                        "        private LoggerInterface $logger,",
                        "    ) {",
                        "    }",
                        "",
                        "    #[Route('/upservice', name: 'upservice')]",
                        "    public function index(): Response",
                        "    {",
                        "        return $this->render(",
                        "            'upservice/index.html.twig',",
                        "            [",
                        "                'services' => [",
                        "                    'HTTPS' => true,",
                        "                    'Database' => $this->checkDatabase(),",
                        "                    'API' => false,",
                        "                ],",
                        "                'xheaders' => $this->getXHeaders(),",
                        "            ]",
                        "        );",
                        "    }",
                        "",
                        "    private function checkDatabase(): bool",
                        "    {",
                        "        //TODO: Check Database Connection",
                        "        return true;",
                        "    }",
                        "",
                        "    private function getXHeaders(): array",
                        "    {",
                        "        $xheaders = [];",
                        "        if ($this->getParameter('app_env') == 'dev') {",
                        "            // @codeCoverageIgnoreStart",
                        "            $tenant = 'XXX'; //TODO Use your own",
                        "            $baseuri = 'https://yours.d-velop.cloud'; //TODO Use your own",
                        "            $private = base64_decode($this->getParameter(\"d3_app_secret\"));",
                        "",
                        "            $signature = base64_encode(hash_hmac('sha256', $baseuri . $tenant, $private, true));",
                        "",
                        "            $xheaders['tenant'] = $tenant;",
                        "            $xheaders['baseuri'] = $baseuri;",
                        "            $xheaders['signature'] = $signature;",
                        "            // @codeCoverageIgnoreEnd",
                        "        }",
                        "",
                        "        return $xheaders;",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/ControllerRegistrator.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App;",
                        "",
                        "use Liondeer\\Framework\\Controller\\AbstractConfigFeatureController;",
                        "use Liondeer\\Framework\\Controller\\AbstractDmsObjectExtensionController;",
                        "use Liondeer\\Framework\\Controller\\AbstractFeatureController;",
                        "use Liondeer\\Framework\\Exception\\LiondeerD3FrameworkException;",
                        "",
                        "class ControllerRegistrator",
                        "{",
                        "    /** @var AbstractFeatureController[] */",
                        "    private array $featureControllers = [];",
                        "    /** @var AbstractConfigFeatureController[] */",
                        "    private array $configFeatureControllers = [];",
                        "    /** @var AbstractDmsObjectExtensionController[] */",
                        "    private array $dmsObjectExtensionControllers = [];",
                        "",
                        "    //Im Konstruktor m\u00fcssen alle Feature- und ConfigFeature-Controller registriert werden",
                        "",
                        "    /**",
                        "     * @throws LiondeerD3FrameworkException",
                        "     */",
                        "    public function __construct(",
                        "    )",
                        "    {",
                        "        foreach (func_get_args() as $object) {",
                        "            if (is_a($object, AbstractFeatureController::class)) {",
                        "                array_push($this->featureControllers, $object);",
                        "            } elseif (is_a($object, AbstractConfigFeatureController::class)) {",
                        "                array_push($this->configFeatureControllers, $object);",
                        "            } elseif (is_a($object, AbstractDmsObjectExtensionController::class)) {",
                        "                array_push($this->dmsObjectExtensionControllers, $object);",
                        "            } else {",
                        "                $message = 'The class is neither \"'",
                        "                    . AbstractFeatureController::class",
                        "                    . '\" or \"'",
                        "                    . AbstractConfigFeatureController::class",
                        "                    .'\" or \"'",
                        "                    .AbstractDmsObjectExtensionController::class;",
                        "",
                        "                throw new LiondeerD3FrameworkException($message, 'LD-1000');",
                        "            }",
                        "        }",
                        "    }",
                        "",
                        "    public function getFeatureControllers(): array",
                        "    {",
                        "        return $this->featureControllers;",
                        "    }",
                        "",
                        "    public function getConfigFeatureControllers(): array",
                        "    {",
                        "        return $this->configFeatureControllers;",
                        "    }",
                        "",
                        "    public function getDmsObjectExtensionControllers(): array",
                        "    {",
                        "        return $this->dmsObjectExtensionControllers;",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Lifecycle/PurgeEvent.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\Lifecycle;",
                        "",
                        "use Liondeer\\Framework\\Lifecycle\\AbstractLivecycleEvent;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class PurgeEvent extends AbstractLivecycleEvent",
                        "{",
                        "    public function __construct(",
                        "    ) {",
                        "    }",
                        "",
                        "    public function processEvent(array $parameters)",
                        "    {",
                        "        //TODO:DEFINE YOUR OWN EVENT",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Lifecycle/ResubscribeEvent.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\Lifecycle;",
                        "",
                        "use Liondeer\\Framework\\Lifecycle\\AbstractLivecycleEvent;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class ResubscribeEvent extends AbstractLivecycleEvent",
                        "{",
                        "    public function __construct(",
                        "    ) {",
                        "    }",
                        "",
                        "    public function processEvent(array $parameters)",
                        "    {",
                        "        //TODO:DEFINE YOUR OWN EVENT",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Lifecycle/SubscribeEvent.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\Lifecycle;",
                        "",
                        "use Liondeer\\Framework\\Lifecycle\\AbstractLivecycleEvent;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class SubscribeEvent extends AbstractLivecycleEvent",
                        "{",
                        "    public function __construct(",
                        "    ) {",
                        "    }",
                        "",
                        "    public function processEvent(array $parameters)",
                        "    {",
                        "        //TODO:DEFINE YOUR OWN EVENT",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Lifecycle/UnsubscribeEvent.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\Lifecycle;",
                        "",
                        "use Liondeer\\Framework\\Lifecycle\\AbstractLivecycleEvent;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class UnsubscribeEvent extends AbstractLivecycleEvent",
                        "{",
                        "    public function __construct(",
                        "    ) {",
                        "    }",
                        "",
                        "    public function processEvent(array $parameters)",
                        "    {",
                        "        //TODO:DEFINE YOUR OWN EVENT",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Security/D3WebhookAuthenticator.php": {
                    "contents": [
                        "<?php /** @noinspection ALL */",
                        "",
                        "namespace App\\security;",
                        "",
                        "use JetBrains\\PhpStorm\\ArrayShape;",
                        "use Psr\\Log\\LoggerInterface;",
                        "use Symfony\\Component\\HttpFoundation\\JsonResponse;",
                        "use Symfony\\Component\\HttpFoundation\\Request;",
                        "use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
                        "use Symfony\\Component\\Security\\Core\\Exception\\AuthenticationException;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserInterface;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserProviderInterface;",
                        "use Symfony\\Component\\Security\\Guard\\AbstractGuardAuthenticator;",
                        "",
                        "class D3WebhookAuthenticator extends AbstractGuardAuthenticator",
                        "{",
                        "    public function __construct(",
                        "        private LoggerInterface $logger",
                        "    )",
                        "    { }",
                        "",
                        "",
                        "    public function supports(Request $request): bool",
                        "    {",
                        "        if (",
                        "            $request->headers->has('x-dv-tenant-id')",
                        "            && $request->headers->has('x-dv-baseuri')",
                        "            && $request->headers->has('x-dv-api-key')",
                        "            && $request->headers->has('x-dv-request-count')",
                        "        ) {",
                        "            return true;",
                        "        }",
                        "",
                        "        return false;",
                        "    }",
                        "",
                        "    #[ArrayShape([",
                        "        'd3TenantId' => \"null|string\",",
                        "        'd3BaseUri' => \"null|string\",",
                        "        'd3ApiKey' => \"null|string\",",
                        "        'd3UserId' => \"null|string\"",
                        "    ])] public function getCredentials(",
                        "        Request $request",
                        "    ): array {",
                        "        return [",
                        "            'd3TenantId' => $request->headers->get('x-dv-tenant-id'),",
                        "            'd3BaseUri' => $request->headers->get('x-dv-baseuri'),",
                        "            'd3ApiKey' => $request->headers->get('x-dv-api-key'),",
                        "            'd3UserId' => $request->headers->get('x-dv-exec-user-id') ?: '',",
                        "        ];",
                        "    }",
                        "",
                        "    public function getUser($credentials, UserProviderInterface $userProvider): ?User",
                        "    {",
                        "        $tenant = $credentials['d3TenantId'];",
                        "",
                        "        if (null === $tenant) {",
                        "            return null;",
                        "        }",
                        "        $user = new User();",
                        "        $user->createDummyUser($credentials['d3BaseUri'], $tenant);",
                        "        $user->setBearerToken($credentials['d3ApiKey']);",
                        "",
                        "        return $user;",
                        "    }",
                        "",
                        "    public function checkCredentials($credentials, UserInterface $user): bool",
                        "    {",
                        "        $tenant = $credentials['d3TenantId'];",
                        "        $baseuri = $credentials['d3BaseUri'];",
                        "        $apiKey = $credentials['d3ApiKey'];",
                        "",
                        "        //TODO API Key gegen dvelop pr\u00fcfen",
                        "        return true;",
                        "    }",
                        "",
                        "    public function onAuthenticationFailure(Request $request, AuthenticationException $exception)",
                        "    {",
                        "        $data = [",
                        "            'message' => strtr($exception->getMessageKey(), $exception->getMessageData())",
                        "",
                        "            // or to translate this message",
                        "            // $this->translator->trans($exception->getMessageKey(), $exception->getMessageData())",
                        "        ];",
                        "",
                        "        return new JsonResponse($data, Response::HTTP_FORBIDDEN);",
                        "    }",
                        "",
                        "    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $providerKey)",
                        "    {",
                        "        return null;",
                        "    }",
                        "",
                        "    public function start(Request $request, AuthenticationException $authException = null)",
                        "    {",
                        "        $data = [",
                        "            // you might translate this message",
                        "            'message' => 'Authentication Required'",
                        "        ];",
                        "",
                        "        return new JsonResponse($data, Response::HTTP_UNAUTHORIZED);",
                        "    }",
                        "",
                        "    public function supportsRememberMe()",
                        "    {",
                        "        return false;",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "src/Security/InterAppUser.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\security;",
                        "",
                        "use Symfony\\Component\\Security\\Core\\User\\UserInterface;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class InterAppUser implements UserInterface",
                        "{",
                        "    private string $tenantId;",
                        "    private array $roles = [];",
                        "    private string $id;",
                        "    private string $username;",
                        "    private array $groups = [];",
                        "    private string $bearerToken;",
                        "    private string $baseUri;",
                        "",
                        "    public function getBaseUri(): string",
                        "    {",
                        "        return $this->baseUri;",
                        "    }",
                        "",
                        "    public function setBaseUri(string $baseUri): self",
                        "    {",
                        "        $this->baseUri = $baseUri;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getBearerToken(): ?string",
                        "    {",
                        "        return $this->bearerToken;",
                        "    }",
                        "",
                        "    public function setBearerToken(string $bearerToken): self",
                        "    {",
                        "        $this->bearerToken = $bearerToken;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getTenantId(): ?string",
                        "    {",
                        "        return $this->tenantId;",
                        "    }",
                        "",
                        "    public function setTenantId(string $tenantId): self",
                        "    {",
                        "        $this->tenantId = $tenantId;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getUsername(): string",
                        "    {",
                        "        return $this->username;",
                        "    }",
                        "",
                        "    public function setUsername(string $username): self",
                        "    {",
                        "        $this->username = $username;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getRoles(): array",
                        "    {",
                        "        $roles = $this->roles;",
                        "        $roles[] = RoleAllocation::USER;",
                        "",
                        "        return array_unique($roles);",
                        "    }",
                        "",
                        "    public function setRoles(array $roles): self",
                        "    {",
                        "        $this->roles = $roles;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getId(): string",
                        "    {",
                        "        return $this->id;",
                        "    }",
                        "",
                        "    public function setId(string $id): self",
                        "    {",
                        "        $this->id = $id;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getGroups(): array",
                        "    {",
                        "        return $this->groups;",
                        "    }",
                        "",
                        "    public function setGroups(array $groups): self",
                        "    {",
                        "        $this->groups = $groups;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function getPassword()",
                        "    {",
                        "        // not needed for apps that do not check user passwords",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function getSalt()",
                        "    {",
                        "        // not needed for apps that do not check user passwords",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function eraseCredentials()",
                        "    {",
                        "        // If you store any temporary, sensitive data on the user, clear it here",
                        "        // $this->plainPassword = null;",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Security/RoleAllocation.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\security;",
                        "",
                        "use Liondeer\\Framework\\Allocation\\AbstractAllocation;",
                        "",
                        "class RoleAllocation extends AbstractAllocation",
                        "{",
                        "    const ADMIN = 'ROLE_ADMIN';",
                        "    const USER = 'ROLE_USER';",
                        "",
                        "    public static function getValues(): array",
                        "    {",
                        "        return self::getAllocationValues();",
                        "    }",
                        "",
                        "    public static function getTranslationKey($constName): string",
                        "    {",
                        "        return self::getAllocationTranslationKey($constName);",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/Security/SmartInvoiceWebhookAuthenticator.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\security;",
                        "",
                        "use App\\Helper\\DuoConfigHelper;",
                        "use DateTime;",
                        "use JetBrains\\PhpStorm\\ArrayShape;",
                        "use Symfony\\Component\\HttpFoundation\\JsonResponse;",
                        "use Symfony\\Component\\HttpFoundation\\Request;",
                        "use Symfony\\Component\\HttpFoundation\\Response;",
                        "use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;",
                        "use Symfony\\Component\\Security\\Core\\Exception\\AuthenticationException;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserInterface;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserProviderInterface;",
                        "use Symfony\\Component\\Security\\Guard\\AbstractGuardAuthenticator;",
                        "",
                        "class SmartInvoiceWebhookAuthenticator extends AbstractGuardAuthenticator",
                        "{",
                        "    private string $requestBody;",
                        "",
                        "    public function __construct(private DuoConfigHelper $helper)",
                        "    {",
                        "    }",
                        "",
                        "    public function supports(Request $request): bool",
                        "    {",
                        "        return $request->headers->has('x-smart-invoice-signature');",
                        "    }",
                        "",
                        "    #[ArrayShape([",
                        "        't' => 'string',",
                        "        'v1' => 'string',",
                        "        'tenantId' => 'string',",
                        "        'baseUri' => 'string'",
                        "    ])]",
                        "    public function getCredentials(Request $request): array",
                        "    {",
                        "        $header = $request->headers->get('x-smart-invoice-signature');",
                        "        $tenantId = $request->headers->get('x-dv-tenant-id');",
                        "        $baseUri = $request->headers->get('x-dv-baseuri');",
                        "        $timestamp = substr(explode(',', $header)[0], 2);",
                        "        $signature = substr(explode(',', $header)[1], 3);",
                        "        $this->requestBody = $request->getContent();",
                        "",
                        "        return ['t' => $timestamp, 'v1' => $signature, 'tenantId' => $tenantId, 'baseUri' => $baseUri];",
                        "    }",
                        "",
                        "    public function getUser($credentials, UserProviderInterface $userProvider): User",
                        "    {",
                        "        $requestBody = json_decode($this->requestBody, true);",
                        "        $user = new User();",
                        "        $user->createDummyUser($credentials['baseUri'], $credentials['tenantId']);",
                        "        if (empty($user->getTenantId())) {",
                        "            if (array_key_exists('base_uri', $requestBody['tenant'])) {",
                        "                $user->createDummyUser($requestBody['tenant']['base_uri'], $requestBody['tenant']['id']);",
                        "            }",
                        "        }",
                        "",
                        "        return $user;",
                        "    }",
                        "",
                        "    public function checkCredentials($credentials, UserInterface $user): bool",
                        "    {",
                        "        //TODO: Secret aus DB holen!!!!!!!!!!!!!einself",
                        "        $shouldFinishAt = new DateTime('+5 sec');",
                        "        /** @var User $user */",
                        "        $secret = $this->helper->getSmartInvoiceSecret($user->getTenantId());",
                        "        $minimumTime = new DateTime('5 minutes ago');",
                        "",
                        "        if ($credentials['t'] < $minimumTime->getTimestamp()) {",
                        "            time_sleep_until($shouldFinishAt->getTimestamp());",
                        "",
                        "            return false;",
                        "        }",
                        "",
                        "        $concatenated = $credentials['t'] . '.' . $this->requestBody;",
                        "        $hashed = hash_hmac('sha256', $concatenated, $secret);",
                        "",
                        "        time_sleep_until($shouldFinishAt->getTimestamp());",
                        "",
                        "        return hash_equals($hashed, $credentials['v1']);",
                        "    }",
                        "",
                        "    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): JsonResponse",
                        "    {",
                        "        $data = [",
                        "            'message' => strtr($exception->getMessageKey(), $exception->getMessageData())",
                        "        ];",
                        "",
                        "        return new JsonResponse($data, Response::HTTP_FORBIDDEN);",
                        "    }",
                        "",
                        "    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $providerKey)",
                        "    {",
                        "        return null;",
                        "    }",
                        "",
                        "    public function start(Request $request, AuthenticationException $authException = null): JsonResponse",
                        "    {",
                        "        $data = [",
                        "            // you might translate this message",
                        "            'message' => 'Authentication Required'",
                        "        ];",
                        "",
                        "        return new JsonResponse($data, Response::HTTP_UNAUTHORIZED);",
                        "    }",
                        "",
                        "    public function supportsRememberMe(): bool",
                        "    {",
                        "        return false;",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "src/Security/User.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\security;",
                        "",
                        "use Liondeer\\Framework\\Model\\Tenant;",
                        "use Liondeer\\Framework\\Transmitter\\Helper\\UserSignatureHelper;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserInterface;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class User implements UserInterface",
                        "{",
                        "    // TODO: Abstract",
                        "    private string $tenantId;",
                        "    private array $roles = [];",
                        "    private string $id;",
                        "    private string $username;",
                        "    private string $firstName;",
                        "    private string $lastName;",
                        "    private string $title;",
                        "    private array $emails = [];",
                        "    private array $phoneNumbers = [];",
                        "    private array $groups = [];",
                        "    private array $photos = [];",
                        "    private ?string $bearerToken = null;",
                        "    private string $baseUri;",
                        "    private string $displayName;",
                        "",
                        "    public function getDisplayName(): string",
                        "    {",
                        "        return $this->displayName;",
                        "    }",
                        "",
                        "    public function setDisplayName(string $displayName): User",
                        "    {",
                        "        $this->displayName = $displayName;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "",
                        "    public function getBearerToken(): ?string",
                        "    {",
                        "        return $this->bearerToken;",
                        "    }",
                        "",
                        "    public function setBearerToken(string $bearerToken): self",
                        "    {",
                        "        $this->bearerToken = $bearerToken;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * A visual identifier that represents this user.",
                        "     *",
                        "     * @see UserInterface",
                        "     */",
                        "    public function getUsername(): string",
                        "    {",
                        "        return $this->username;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param string $username",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setUsername(string $username): self",
                        "    {",
                        "        $this->username = $username;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function getRoles(): array",
                        "    {",
                        "        //return (['ROLE_USER']);",
                        "",
                        "        return array_unique($this->roles);",
                        "    }",
                        "",
                        "    public function setRoles(array $roles): self",
                        "    {",
                        "        $this->roles = $roles;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return string",
                        "     */",
                        "    public function getFirstName(): string",
                        "    {",
                        "        return $this->firstName;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param string $firstName",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setFirstName(string $firstName): self",
                        "    {",
                        "        $this->firstName = $firstName;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return string",
                        "     */",
                        "    public function getLastName(): string",
                        "    {",
                        "        return $this->lastName;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param string $lastName",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setLastName(string $lastName): self",
                        "    {",
                        "        $this->lastName = $lastName;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return string",
                        "     */",
                        "    public function getTitle(): string",
                        "    {",
                        "        return $this->title;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param string $title",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setTitle(string $title): self",
                        "    {",
                        "        $this->title = $title;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return array",
                        "     */",
                        "    public function getEmails(): array",
                        "    {",
                        "        return $this->emails;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param array $emails",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setEmails(array $emails): self",
                        "    {",
                        "        $this->emails = $emails;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return array",
                        "     */",
                        "    public function getPhoneNumbers(): array",
                        "    {",
                        "        return $this->phoneNumbers;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param array $phoneNumbers",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setPhoneNumbers(array $phoneNumbers): self",
                        "    {",
                        "        $this->phoneNumbers = $phoneNumbers;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return array",
                        "     */",
                        "    public function getGroups(): array",
                        "    {",
                        "        return $this->groups;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param array $groups",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setGroups(array $groups): self",
                        "    {",
                        "        $this->groups = $groups;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @return array",
                        "     */",
                        "    public function getPhotos(): array",
                        "    {",
                        "        return $this->photos;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param array $photos",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setPhotos(array $photos): self",
                        "    {",
                        "        $this->photos = $photos;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function createDummyUser(string $baseUri, string $tenantId): self",
                        "    {",
                        "        $this->id = '1';",
                        "        $this->username = 'brave.elephant';",
                        "        $this->firstName = 'Brave';",
                        "        $this->lastName = 'Elephant';",
                        "        $this->roles = ['ROLE_BRAVE_USER'];",
                        "        $this->baseUri = $baseUri;",
                        "        $this->tenantId = $tenantId;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getTenant(): Tenant",
                        "    {",
                        "        $tenant = new Tenant();",
                        "        $tenant",
                        "            ->setTenantId($this->getTenantId())",
                        "            ->setBaseUri($this->getBaseUri());",
                        "",
                        "        return $tenant;",
                        "    }",
                        "",
                        "    public function getTenantId(): ?string",
                        "    {",
                        "        return $this->tenantId;",
                        "    }",
                        "",
                        "    public function setTenantId(string $tenantId): self",
                        "    {",
                        "        $this->tenantId = $tenantId;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getBaseUri(): string",
                        "    {",
                        "        return $this->baseUri;",
                        "    }",
                        "",
                        "    public function setBaseUri(string $baseUri): self",
                        "    {",
                        "        $this->baseUri = $baseUri;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function getPassword(): ?string",
                        "    {",
                        "        // not needed for apps that do not check user passwords",
                        "        return null;",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function getSalt(): ?string",
                        "    {",
                        "        // not needed for apps that do not check user passwords",
                        "        return null;",
                        "    }",
                        "",
                        "    /**",
                        "     * @see UserInterface",
                        "     */",
                        "    public function eraseCredentials()",
                        "    {",
                        "        // If you store any temporary, sensitive data on the user, clear it here",
                        "        // $this->plainPassword = null;",
                        "    }",
                        "",
                        "    public function getSignature(): string",
                        "    {",
                        "        $userSignatureHelper = new UserSignatureHelper();",
                        "",
                        "        return $userSignatureHelper->getSignature($this->getTenantId(), $this->getId());",
                        "    }",
                        "",
                        "    /**",
                        "     * @return string",
                        "     */",
                        "    public function getId(): string",
                        "    {",
                        "        return $this->id;",
                        "    }",
                        "",
                        "    /**",
                        "     * @param string $id",
                        "     *",
                        "     * @return User",
                        "     */",
                        "    public function setId(string $id): self",
                        "    {",
                        "        $this->id = $id;",
                        "",
                        "        return $this;",
                        "    }",
                        "",
                        "    public function getUserIdentifier(): string",
                        "    {",
                        "        return $this->id;",
                        "    }",
                        "}",
                        ""
                    ],
                    "executable": false
                },
                "src/Security/UserProvider.php": {
                    "contents": [
                        "<?php",
                        "",
                        "namespace App\\security;",
                        "",
                        "use Exception;",
                        "use Symfony\\Component\\Security\\Core\\Exception\\UnsupportedUserException;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserInterface;",
                        "use Symfony\\Component\\Security\\Core\\User\\UserProviderInterface;",
                        "",
                        "/** @codeCoverageIgnore */",
                        "class UserProvider implements UserProviderInterface",
                        "{",
                        "    /**",
                        "     * Symfony calls this method if you use features like switch_user",
                        "     * or remember_me.",
                        "     *",
                        "     * If you're not using these features, you do not need to implement",
                        "     * this method.",
                        "     *",
                        "     * @param $username",
                        "     * @return void",
                        "     *",
                        "     * @throws Exception",
                        "     */",
                        "    public function loadUserByUsername($username)",
                        "    {",
                        "        // Load a User object from your data source or throw UsernameNotFoundException.",
                        "        // The $username argument may not actually be a username:",
                        "        // it is whatever value is being returned by the getUsername()",
                        "        // method in your User class.",
                        "        throw new Exception('TODO: fill in loadUserByUsername() inside ' . __FILE__);",
                        "    }",
                        "",
                        "    /**",
                        "     * Refreshes the user after being reloaded from the session.",
                        "     *",
                        "     * When a user is logged in, at the beginning of each request, the",
                        "     * User object is loaded from the session and then this method is",
                        "     * called. Your job is to make sure the user's data is still fresh by,",
                        "     * for example, re-querying for fresh User data.",
                        "     *",
                        "     * If your firewall is \"stateless: true\" (for a pure API), this",
                        "     * method is not called.",
                        "     *",
                        "     * @param \\Symfony\\Component\\Security\\Core\\User\\UserInterface $user",
                        "     * @return UserInterface",
                        "     */",
                        "    public function refreshUser(UserInterface $user): UserInterface",
                        "    {",
                        "        if (!$user instanceof User) {",
                        "            throw new UnsupportedUserException(sprintf('Invalid user class \"%s\".', get_class($user)));",
                        "        }",
                        "",
                        "        return $user;",
                        "        // Return a User object after making sure its data is \"fresh\".",
                        "        // Or throw a UsernameNotFoundException if the user no longer exists.",
                        "        //throw new Exception('TODO: fill in refreshUser() inside '.__FILE__);",
                        "    }",
                        "",
                        "    /**",
                        "     * Tells Symfony to use this provider for this User class.",
                        "     */",
                        "    public function supportsClass($class): bool",
                        "    {",
                        "        return User::class === $class;",
                        "    }",
                        "}"
                    ],
                    "executable": false
                },
                "src/VERSION": {
                    "contents": [
                        "V0.0.1"
                    ],
                    "executable": false
                },
                "src/templates/translation/translation.js.twig": {
                    "contents": [
                        "let trans = JSON.parse('{{  json|raw }}');"
                    ],
                    "executable": false
                },
                "src/templates/upservice/index.html.twig": {
                    "contents": [
                        "<!DOCTYPE html>",
                        "<html>",
                        "<head>",
                        "    <meta charset=\"UTF-8\">",
                        "    <title>Upservice</title>",
                        "</head>",
                        "<body>",
                        "",
                        "<h3>Version</h3>",
                        "{{ 'general.appVersion'|trans({'%app-version%': shivas_app_version}) }}",
                        "",
                        "<h3>Status</h3>",
                        "{% for service, status in services %}",
                        "    {% if status %}",
                        "        * {{ service }} - OK<br>",
                        "    {% else %}",
                        "        * {{ service }} - FAILED<br>",
                        "    {% endif %}",
                        "{% endfor %}",
                        "",
                        "{% if APP_ENV == 'dev' %}",
                        "    <h3>Request-Headers</h3>",
                        "    * x-dv-tenant-id: {{ xheaders.tenant }}<br>",
                        "    * x-dv-baseuri: {{ xheaders.baseuri }}<br>",
                        "    * x-dv-sig-1: {{ xheaders.signature }}<br>",
                        "{% endif %}",
                        "</body>",
                        "</html>",
                        ""
                    ],
                    "executable": false
                },
                "src/translations/messages.de.yml": {
                    "contents": [
                        ""
                    ],
                    "executable": false
                }
            },
            "ref": "28c966e6ff4a9e6f319c37fb45ad8b7247ae65c8"
        }
    }
}
